Entendido! Voc√™ quer um detalhamento completo da P√°gina de Adi√ß√£o de Novo Canal, cobrindo n√£o apenas a Z-API, mas tamb√©m as integra√ß√µes com Instagram Direct (Meta API), Facebook Messenger (Meta API), Email (SMTP/IMAP e OAuth), SMS (Twilio) e Telefonia (Voz - Twilio). O objetivo √© ter um guia √∫nico e rico em detalhes para construir essa funcionalidade crucial.

Vamos l√°!

Relat√≥rio Detalhado: P√°gina de Adi√ß√£o e Configura√ß√£o de Canais de Comunica√ß√£o

I. Vis√£o Geral e Prop√≥sito

A funcionalidade "Adicionar Novo Canal", acessada a partir da subp√°gina "Canais de Comunica√ß√£o" (dentro das "Configura√ß√µes do Tenant"), √© o portal para expandir o alcance da plataforma Omnichannel do tenant. Ela deve guiar o administrador atrav√©s de um processo claro e seguro para conectar as diversas contas e plataformas de comunica√ß√£o que a empresa utiliza, centralizando todas as intera√ß√µes na Caixa de Entrada Unificada.

A interface precisa ser intuitiva, fornecer instru√ß√µes adequadas para cada tipo de canal e garantir que as configura√ß√µes necess√°rias, como credenciais e webhooks, sejam corretamente inseridas ou informadas.

II. Ponto de Partida: A Subp√°gina "Canais de Comunica√ß√£o"

O administrador do tenant navega para "Configura√ß√µes do Tenant" ‚û°Ô∏è aba "Canais de Comunica√ß√£o".
Visualiza a lista de canais j√° configurados (se houver).
Clica no bot√£o + Adicionar Novo Canal.
III. Fluxo de Adi√ß√£o de Novo Canal (Wizard Passo a Passo Detalhado)

Passo 1: Sele√ß√£o do Tipo de Canal Principal

Interface: Uma tela de sele√ß√£o visualmente atraente (pode ser um modal de tela cheia ou uma nova p√°gina dentro do fluxo de configura√ß√µes).
T√≠tulo: "Qual canal voc√™ gostaria de adicionar?"
Op√ß√µes Apresentadas como Cards ou Itens de Lista com √çcones e Nomes Claros:
üí¨ WhatsApp
üì∑ Instagram Direct
üëç Facebook Messenger
‚úâÔ∏è Email
üì± SMS
üìû Telefonia (Voz)
A√ß√£o: O administrador clica no card do tipo de canal desejado. Ao clicar, o sistema avan√ßa para o pr√≥ximo passo relevante.
Passo 2 (Condicional): Sele√ß√£o do Provedor/M√©todo de Conex√£o (se aplic√°vel)

Este passo s√≥ √© exibido se o tipo de canal selecionado no Passo 1 tiver m√∫ltiplas op√ß√µes de integra√ß√£o.
Exemplo para WhatsApp Selecionado no Passo 1:
T√≠tulo: "Como voc√™ deseja conectar o WhatsApp?"
Op√ß√µes (Radio buttons com breve descri√ß√£o dos pr√≥s e contras):
API Oficial do WhatsApp (Ex: Gupshup, Twilio API for WhatsApp): "Recomendado para empresas que buscam estabilidade, conformidade e uso de templates de mensagens aprovados pela Meta."
Conex√£o via Z-API (Leitura de QR Code): "Oferece maior flexibilidade para mensagens, mas requer um celular dedicado conectado √† internet e √© importante estar ciente das pol√≠ticas de uso do WhatsApp para evitar bloqueios."
A√ß√£o: Usu√°rio seleciona o provedor/m√©todo e clica em "Pr√≥ximo" ou "Configurar [Provedor]".
Passo 3: Formul√°rio de Configura√ß√£o Espec√≠fico do Canal e Provedor

Esta √© a etapa mais crucial e varia significativamente. Todos os formul√°rios devem incluir no topo:

Nome Personalizado do Canal (Obrigat√≥rio): Campo de texto para o administrador identificar este canal internamente (ex: "WhatsApp Vendas - Oficial", "Instagram Loja Principal", "Suporte Geral Email", "SMS Marketing - Twilio").
A. Configura√ß√£o para WhatsApp via API Oficial (Ex: Gupshup ou Twilio for WhatsApp)
* T√≠tulo: "Configurar WhatsApp via [Nome do Provedor Oficial]".
* Instru√ß√µes Iniciais: Links para a documenta√ß√£o do provedor (Gupshup/Twilio) sobre como obter as credenciais e pr√©-requisitos (ex: conta aprovada no Facebook Business Manager, n√∫mero de telefone verificado).
* Campos de Credenciais Espec√≠ficos do Provedor:
* Para Gupshup:
* API Key da Gupshup: Campo tipo password.
* ID do Aplicativo WhatsApp (ou Nome do App na Gupshup): Campo de texto.
* N√∫mero de Telefone WhatsApp Business API (com DDI): Associado √† conta Gupshup.
* Para Twilio API for WhatsApp:
* Twilio Account SID: Campo tipo password.
* Twilio Auth Token: Campo tipo password.
* N√∫mero de Telefone WhatsApp da Twilio (ou Messaging Service SID): Sele√ß√£o de um n√∫mero/servi√ßo configurado na Twilio.
* Configura√ß√£o de Webhook:
* URL de Webhook (Fornecida pelo Sistema Omnichannel): O sistema exibir√° uma URL √∫nica e segura (ex: https://[sua_plataforma.com]/webhooks/tenant/[tenant_id]/[provedor_whatsapp]/[channel_id]).
* Instru√ß√£o Clara: "Copie esta URL e cole no campo 'Callback URL' ou 'Webhook URL' nas configura√ß√µes do seu aplicativo WhatsApp na plataforma do provedor ([Gupshup/Twilio]). Certifique-se de habilitar os eventos para recebimento de mensagens e atualiza√ß√µes de status de entrega."
* Valida√ß√£o da Conex√£o:
* Bot√£o Testar Conex√£o com [Provedor]. (Backend tenta uma chamada de API simples usando as credenciais).
* Feedback de sucesso ou erro.
* Pr√≥ximos Passos Informativos: Lembretes sobre o processo de aprova√ß√£o de templates de mensagem (HSMs) pela Meta, que √© essencial para iniciar conversas com clientes.

B. Configura√ß√£o para WhatsApp via Z-API
* (Conforme detalhado extensivamente na sua solicita√ß√£o anterior, incluindo Client Token, gera√ß√£o e exibi√ß√£o de QR Code a partir de bytes, polling de status da conex√£o, e instru√ß√µes para o usu√°rio configurar a URL de Webhook fornecida pelo sistema Omnichannel na plataforma Z-API).

C. Configura√ß√£o para Instagram Direct (Meta API)
* T√≠tulo: "Conectar Instagram Direct".
* Instru√ß√µes Iniciais: Requisitos: Conta Instagram Business conectada a uma P√°gina do Facebook, permiss√µes de Administrador na P√°gina e na Aplica√ß√£o Meta associada.
* Bot√£o Conectar com Facebook/Instagram:
* Inicia o fluxo OAuth2 da Meta. Usu√°rio √© redirecionado para o Facebook para autenticar e conceder as permiss√µes necess√°rias (ex: instagram_manage_messages, pages_messaging, instagram_basic, pages_show_list).
* Ap√≥s Autoriza√ß√£o OAuth Bem-sucedida:
* Sele√ß√£o da Conta Instagram Business: Se o usu√°rio gerencia m√∫ltiplas contas, uma lista das Contas Instagram Business dispon√≠veis (para as quais as permiss√µes foram concedidas) √© exibida. O usu√°rio seleciona UMA conta para este canal.
* Exibi√ß√£o da P√°gina do Facebook vinculada (informativo).
* Configura√ß√£o de Webhooks (Idealmente Automatizada pelo Backend):
* O backend (usando o token de acesso obtido) tenta subscrever a Aplica√ß√£o Meta do tenant aos webhook fields do Instagram (messages, message_reads, etc.) para a conta selecionada.
* Ele aponta o webhook para a URL do sistema Omnichannel (ex: https://[sua_plataforma.com]/webhooks/tenant/[tenant_id]/meta/instagram/[channel_id]) e configura um Verify Token (gerado pelo sistema Omnichannel).
* Feedback: Mensagem de "Webhooks do Instagram configurados com sucesso!" ou, se a automa√ß√£o falhar, instru√ß√µes claras e os valores (URL de Webhook, Verify Token) para o usu√°rio configurar manualmente no painel de Desenvolvedores da Meta (na se√ß√£o Webhooks da Aplica√ß√£o Meta).
* Status da Integra√ß√£o: Indicador visual do status da conex√£o do token e da verifica√ß√£o do webhook.
* Link para Renovar Permiss√µes / Reconectar (importante, pois tokens da Meta podem expirar ou permiss√µes serem revogadas).

D. Configura√ß√£o para Facebook Messenger (Meta API)
* T√≠tulo: "Conectar Facebook Messenger".
* Instru√ß√µes Iniciais: Requisitos: P√°gina do Facebook e permiss√µes de Administrador, Aplica√ß√£o Meta.
* Bot√£o Conectar com Facebook: (Pode ser o mesmo fluxo OAuth2 do Instagram, solicitando as permiss√µes corretas).
* Ap√≥s Autoriza√ß√£o OAuth Bem-sucedida:
* Sele√ß√£o da P√°gina do Facebook: Lista das P√°ginas do Facebook que o usu√°rio gerencia e para as quais concedeu permiss√£o. Usu√°rio seleciona UMA p√°gina para este canal.
* Configura√ß√£o de Webhooks (Idealmente Automatizada):
* Similar ao Instagram, o backend tenta subscrever aos webhook fields do Messenger (messages, messaging_postbacks, etc.) para a p√°gina selecionada, apontando para a URL do sistema Omnichannel (ex: .../meta/facebook/[channel_id]) e configurando o Verify Token.
* Feedback e instru√ß√µes para configura√ß√£o manual, se necess√°rio.
* Status da Integra√ß√£o: Indicador visual do status do token e webhook.
* Link para Renovar Permiss√µes / Reconectar.

E. Configura√ß√£o para Email
* T√≠tulo: "Configurar Conta de Email para Atendimento".
* Endere√ßo de Email do Canal (Obrigat√≥rio): (ex: "suporte@empresa.com"). Este ser√° o email que receber√° as mensagens e, geralmente, o remetente.
* Nome do Remetente Padr√£o para Respostas: (ex: "Equipe de Suporte [Nome do Tenant]").
* M√©todo de Conex√£o (Radio Buttons ou Dropdown):
* Conectar com Google (Gmail/Google Workspace):
* Bot√£o Entrar com Google que inicia o fluxo OAuth2, solicitando permiss√µes para ler, enviar e gerenciar emails da conta selecionada.
* Conectar com Microsoft (Outlook.com/Microsoft 365):
* Bot√£o Entrar com Microsoft que inicia o fluxo OAuth2 similar.
* Configurar Manualmente (Outro Provedor - SMTP/IMAP):
* Configura√ß√µes IMAP (Recebimento de Emails):
* Servidor IMAP (Host): Ex: https://www.google.com/search?q=imap.exemplo.com
* Porta IMAP: Ex: 993
* Usu√°rio IMAP: (geralmente o endere√ßo de email)
* Senha IMAP (ou Senha de Aplicativo espec√≠fica gerada pelo provedor de email): Campo tipo password.
* Seguran√ßa IMAP: Dropdown (SSL/TLS, STARTTLS, Nenhuma).
* Configura√ß√µes SMTP (Envio de Emails):
* Servidor SMTP (Host): Ex: smtp.exemplo.com
* Porta SMTP: Ex: 465 ou 587
* Usu√°rio SMTP: (pode ser o mesmo do IMAP ou diferente)
* Senha SMTP (ou Senha de Aplicativo): Campo tipo password.
* Seguran√ßa SMTP: Dropdown (SSL/TLS, STARTTLS, Nenhuma).
* Bot√£o Testar Conex√£o SMTP/IMAP (envia um email de teste para o pr√≥prio endere√ßo e tenta buscar, ou valida as credenciais).
* (Opcional) Assinatura de Email Padr√£o para este Canal: Editor de texto rico para criar uma assinatura que ser√° anexada √†s respostas.
* (Opcional) Pasta IMAP a ser Monitorada (al√©m da Caixa de Entrada): Se o usu√°rio quiser que emails de uma pasta espec√≠fica tamb√©m gerem conversas.

F. Configura√ß√£o para Telefonia (Voz - Twilio)
* T√≠tulo: "Configurar Linha Telef√¥nica (Twilio Voice)".
* Instru√ß√µes Iniciais: Informar sobre a necessidade de uma conta Twilio ativa e as credenciais Account SID e Auth Token.
* Campos de Credenciais Twilio:
* Twilio Account SID: Campo tipo password.
* Twilio Auth Token: Campo tipo password.
* Gerenciamento de N√∫meros de Telefone Twilio:
* Bot√£o Buscar N√∫meros de Telefone Twilio Dispon√≠veis. (Backend usa as credenciais para listar os n√∫meros de telefone ativos na conta Twilio do tenant que suportam voz).
* Dropdown/Lista de Sele√ß√£o: "Selecione o n√∫mero Twilio que ser√° usado para este canal de voz".
* (Avan√ßado) Link ou interface para buscar/comprar novos n√∫meros via API Twilio, se a plataforma oferecer essa conveni√™ncia.
* Configura√ß√£o de Webhooks de Chamada (Instru√ß√µes para o Usu√°rio):
* O sistema Omnichannel exibir√° as URLs de Webhook que o administrador do tenant precisar√° configurar no painel da Twilio para o n√∫mero de telefone selecionado:
* QUANDO UMA CHAMADA CHEGA (A CALL COMES IN - Voice URL / TwiML App): (ex: https://[sua_plataforma.com]/webhooks/tenant/[tenant_id]/twilio/voice/incoming_call/[channel_id]). Esta URL no seu backend receber√° a notifica√ß√£o de uma nova chamada e poder√° retornar TwiML para controlar a chamada (ex: enfileirar, tocar mensagem, conectar a agente).
* QUANDO O STATUS DA CHAMADA MUDA (StatusCallback URL): (ex: https://[sua_plataforma.com]/webhooks/tenant/[tenant_id]/twilio/voice/call_status/[channel_id]). Para receber atualiza√ß√µes sobre o progresso e finaliza√ß√£o da chamada.
* (Opcional) Configura√ß√£o de L√≥gica de Atendimento Inicial:
* Dropdown "A√ß√£o para Chamada Recebida neste N√∫mero:":
* Direcionar para Fila de Agentes Omnichannel (O sistema gerencia a distribui√ß√£o).
* Tocar Mensagem de √Åudio de Sauda√ß√£o e Enfileirar. (Campo para upload do √°udio ou URL).
* (Avan√ßado) Usar TwiML App SID existente na Twilio: Campo para inserir o SID de um TwiML App que o tenant j√° configurou na Twilio para URA ou fluxos de chamada complexos.
* Checkbox: Habilitar Grava√ß√£o de Chamadas para este canal? (Informativo, pois a grava√ß√£o em si √© configurada e armazenada na Twilio, mas o sistema pode precisar saber se deve buscar links de grava√ß√£o).

G. Configura√ß√£o para SMS (Twilio)
* T√≠tulo: "Configurar Canal SMS (Twilio)".
* Credenciais Twilio: (Podem ser as mesmas da configura√ß√£o de Voz. Se j√° inseridas, o sistema pode reutilizar ou pedir confirma√ß√£o).
* Twilio Account SID.
* Twilio Auth Token.
* Sele√ß√£o de Remetente SMS Twilio:
* Dropdown/Lista para "Selecione o Remetente SMS":
* Listar N√∫meros de Telefone da conta Twilio que s√£o habilitados para SMS.
* Listar Messaging Service SIDs configurados na conta Twilio (recomendado pela Twilio para funcionalidades avan√ßadas como sele√ß√£o de m√∫ltiplos n√∫meros, short codes, Alphanumeric Sender ID onde suportado).
* Configura√ß√£o de Webhooks de SMS (Instru√ß√µes para o Usu√°rio):
* O sistema Omnichannel exibir√° a URL de Webhook para:
* QUANDO UMA MENSAGEM CHEGA (A MESSAGE COMES IN - Message Webhook URL): (ex: https://[sua_plataforma.com]/webhooks/tenant/[tenant_id]/twilio/sms/incoming_message/[channel_id]). Para receber SMS de entrada.
* (Opcional) URL de Webhook para Status de Entrega (STATUS CALLBACK URL): Para receber atualiza√ß√µes de status de entrega de SMS enviados pela plataforma.
* Lembretes sobre custos de SMS, conformidade com opt-in, e a necessidade de fornecer uma maneira para os destinat√°rios fazerem opt-out (ex: responder SAIR).

Passo 4: Op√ß√µes Adicionais e Ativa√ß√£o do Canal (Comum a todos os fluxos)

T√≠tulo da Etapa: "4. Configura√ß√µes Adicionais e Ativa√ß√£o"
(Opcional) Atribuir a Equipes Padr√£o: Multi-select para definir quais equipes de agentes ter√£o acesso prim√°rio ou ser√£o notificadas por padr√£o para novas conversas neste canal.
(Opcional) Mensagem de Sauda√ß√£o Autom√°tica: (Se aplic√°vel e suportado pelo canal/provedor) Campo para definir uma primeira resposta autom√°tica para novas conversas (ex: "Ol√°! Bem-vindo √† [Nome do Tenant]. Um de nossos agentes estar√° com voc√™ em breve.").
(Opcional) Hor√°rio de Funcionamento do Canal:
Interface para definir dias da semana e hor√°rios em que o canal est√° "aberto" para atendimento humano.
Mensagem Autom√°tica Fora do Hor√°rio de Funcionamento: Campo para configurar uma resposta padr√£o quando um contato entra em contato fora do hor√°rio definido (ex: "Nosso hor√°rio de atendimento √© de segunda a sexta, das 9h √†s 18h. Entraremos em contato assim que poss√≠vel.").
Checkbox: Ativar este canal imediatamente ap√≥s salvar e concluir a configura√ß√£o. (Marcado por padr√£o).
Passo 5: Revis√£o e Confirma√ß√£o

T√≠tulo da Etapa: "5. Revise e Conclua a Configura√ß√£o do seu Novo Canal"
Sum√°rio Completo: Exibi√ß√£o organizada de todas as configura√ß√µes principais inseridas para o canal:
Nome Personalizado, Tipo de Canal, Provedor (se aplic√°vel), Identificador Principal (N√∫mero, Email, P√°gina).
Status da Conex√£o (se j√° p√¥de ser verificado, ex: Z-API "Conectado", Email "Teste SMTP/IMAP OK").
Lembrete claro sobre quaisquer etapas manuais ainda necess√°rias (ex: "Lembre-se de configurar a URL de Webhook [URL] na sua plataforma [Nome do Provedor] para que o sistema possa receber mensagens.").
Bot√µes de A√ß√£o Finais:
Salvar e Ativar Canal (se o checkbox de ativa√ß√£o estiver marcado e as configura√ß√µes m√≠nimas estiverem v√°lidas).
Salvar como Rascunho/Inativo (se algumas configura√ß√µes externas ainda estiverem pendentes ou o admin n√£o quiser ativar imediatamente).
Voltar para Editar Passo Anterior.
Cancelar Cria√ß√£o.
IV. Considera√ß√µes Chave para a P√°gina de Adi√ß√£o de Canais

Seguran√ßa das Credenciais: Absolutamente CRUCIAL. Todas as chaves de API, tokens, senhas devem ser transmitidas de forma segura (HTTPS) para o backend e armazenadas l√° de forma criptografada. Nunca expor no frontend.
Feedback ao Usu√°rio Constante: Mensagens claras de sucesso, erro (com detalhes √∫teis), e status durante todo o processo. Indicadores de carregamento para a√ß√µes demoradas.
Valida√ß√£o Rigorosa: Frontend e backend para todos os campos (formato de API keys, URLs, n√∫meros de telefone, etc.).
Instru√ß√µes Claras e Ajuda Contextual: Para cada tipo de canal e provedor, fornecer instru√ß√µes passo a passo e links para a documenta√ß√£o relevante do provedor. Usar tooltips para explicar campos menos √≥bvios.
Testabilidade: Onde poss√≠vel (Email SMTP/IMAP, Gupshup/Twilio com credenciais), incluir bot√µes de "Testar Conex√£o" para validar as configura√ß√µes antes de salvar.
Modularidade: A interface deve ser constru√≠da de forma que adicionar suporte a novos canais ou provedores no futuro seja uma tarefa de adicionar um novo "m√≥dulo de configura√ß√£o" a este fluxo, sem refatorar tudo.
Ao implementar a p√°gina de adi√ß√£o de canais com este n√≠vel de detalhe e foco na experi√™ncia do administrador, voc√™ tornar√° o processo de integra√ß√£o de diversos pontos de contato o mais simples e seguro poss√≠vel para seus tenants.