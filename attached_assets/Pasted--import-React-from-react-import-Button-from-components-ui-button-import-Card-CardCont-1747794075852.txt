
import React from "react";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Checkbox } from "@/components/ui/checkbox";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Textarea } from "@/components/ui/textarea";
import { Plus, Save } from "lucide-react";

export const ContextRulesTab = () => {
  return (
    <div className="space-y-6">
      <div className="space-y-1">
        <h2 className="text-2xl font-bold">Regras e Contextos</h2>
        <p className="text-muted-foreground">
          Configure como a IA Prof. Ana deve se comportar em diferentes contextos
        </p>
      </div>
      
      <Tabs defaultValue="contexts">
        <TabsList>
          <TabsTrigger value="contexts">Contextos</TabsTrigger>
          <TabsTrigger value="rules">Regras Gerais</TabsTrigger>
          <TabsTrigger value="fallbacks">Respostas de Fallback</TabsTrigger>
        </TabsList>
        
        <TabsContent value="contexts" className="space-y-4 pt-4">
          <div className="flex justify-between items-center">
            <h3 className="text-lg font-medium">Contextos Configurados</h3>
            <Button>
              <Plus className="mr-2 h-4 w-4" /> Novo Contexto
            </Button>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
            <Card>
              <CardHeader className="pb-2">
                <div className="flex justify-between items-start">
                  <CardTitle className="text-base">Atendimento de Vendas</CardTitle>
                  <div className="flex items-center h-5">
                    <div className="h-2 w-2 rounded-full bg-green-500 mr-1" />
                    <span className="text-xs text-muted-foreground">Ativo</span>
                  </div>
                </div>
                <CardDescription className="text-xs">
                  Aplicado quando: Canal de WhatsApp de Vendas, Chat no site em páginas de produto
                </CardDescription>
              </CardHeader>
              <CardContent className="pt-0">
                <div className="space-y-2">
                  <div className="text-xs text-muted-foreground">
                    <span className="font-medium">Prioridade:</span> Alta
                  </div>
                  <div className="text-xs text-muted-foreground">
                    <span className="font-medium">Fontes de Conhecimento:</span> Catálogo de Produtos, FAQ de Vendas, Política de Preços
                  </div>
                  <div className="flex justify-end mt-2">
                    <Button variant="ghost" size="sm" className="text-xs h-7">Editar</Button>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card>
              <CardHeader className="pb-2">
                <div className="flex justify-between items-start">
                  <CardTitle className="text-base">Suporte Técnico</CardTitle>
                  <div className="flex items-center h-5">
                    <div className="h-2 w-2 rounded-full bg-green-500 mr-1" />
                    <span className="text-xs text-muted-foreground">Ativo</span>
                  </div>
                </div>
                <CardDescription className="text-xs">
                  Aplicado quando: Canal de WhatsApp de Suporte, Chat no site em páginas de ajuda
                </CardDescription>
              </CardHeader>
              <CardContent className="pt-0">
                <div className="space-y-2">
                  <div className="text-xs text-muted-foreground">
                    <span className="font-medium">Prioridade:</span> Média
                  </div>
                  <div className="text-xs text-muted-foreground">
                    <span className="font-medium">Fontes de Conhecimento:</span> Manual do Produto, FAQ de Suporte, Base de Conhecimento Técnico
                  </div>
                  <div className="flex justify-end mt-2">
                    <Button variant="ghost" size="sm" className="text-xs h-7">Editar</Button>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card>
              <CardHeader className="pb-2">
                <div className="flex justify-between items-start">
                  <CardTitle className="text-base">Prospecção e Marketing</CardTitle>
                  <div className="flex items-center h-5">
                    <div className="h-2 w-2 rounded-full bg-blue-500 mr-1" />
                    <span className="text-xs text-muted-foreground">Agendado</span>
                  </div>
                </div>
                <CardDescription className="text-xs">
                  Aplicado quando: Instagram DM, Facebook Messenger, Campanhas de Marketing
                </CardDescription>
              </CardHeader>
              <CardContent className="pt-0">
                <div className="space-y-2">
                  <div className="text-xs text-muted-foreground">
                    <span className="font-medium">Prioridade:</span> Baixa
                  </div>
                  <div className="text-xs text-muted-foreground">
                    <span className="font-medium">Fontes de Conhecimento:</span> Materiais de Marketing, Blog da Empresa, Casos de Sucesso
                  </div>
                  <div className="flex justify-end mt-2">
                    <Button variant="ghost" size="sm" className="text-xs h-7">Editar</Button>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
          
          <Card className="mt-6">
            <CardHeader>
              <CardTitle className="text-lg">Criar/Editar Contexto</CardTitle>
              <CardDescription>
                Defina como a IA deve se comportar em contextos específicos
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="contextName">Nome do Contexto</Label>
                <Input id="contextName" placeholder="Ex: Suporte Técnico, Atendimento de Vendas, etc." />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="contextDescription">Descrição do Contexto</Label>
                <Textarea id="contextDescription" placeholder="Descreva o propósito deste contexto..." />
              </div>
              
              <div className="space-y-2">
                <Label>Quando Aplicar este Contexto</Label>
                <Card className="p-4">
                  <div className="space-y-4">
                    <div className="flex items-center gap-2">
                      <Label className="font-medium">Condições:</Label>
                      <Select defaultValue="all">
                        <SelectTrigger id="conditionType" className="w-32">
                          <SelectValue placeholder="Relação" />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="all">Todas (E)</SelectItem>
                          <SelectItem value="any">Qualquer (OU)</SelectItem>
                        </SelectContent>
                      </Select>
                      <Button variant="outline" size="sm">
                        <Plus className="h-3 w-3 mr-1" /> Adicionar Condição
                      </Button>
                    </div>
                    
                    <div className="space-y-2">
                      <div className="flex items-center gap-2">
                        <Select defaultValue="channel">
                          <SelectTrigger className="w-40">
                            <SelectValue placeholder="Campo" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="channel">Canal</SelectItem>
                            <SelectItem value="url">URL</SelectItem>
                            <SelectItem value="userType">Tipo de Usuário</SelectItem>
                            <SelectItem value="intent">Intenção Detectada</SelectItem>
                          </SelectContent>
                        </Select>
                        
                        <Select defaultValue="equals">
                          <SelectTrigger className="w-40">
                            <SelectValue placeholder="Operador" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="equals">Igual a</SelectItem>
                            <SelectItem value="contains">Contém</SelectItem>
                            <SelectItem value="startsWith">Começa com</SelectItem>
                            <SelectItem value="endsWith">Termina com</SelectItem>
                          </SelectContent>
                        </Select>
                        
                        <Input placeholder="Valor" className="flex-1" />
                        
                        <Button variant="ghost" size="sm" className="px-2">
                          ×
                        </Button>
                      </div>
                      
                      <div className="flex items-center gap-2">
                        <Select defaultValue="intent">
                          <SelectTrigger className="w-40">
                            <SelectValue placeholder="Campo" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="channel">Canal</SelectItem>
                            <SelectItem value="url">URL</SelectItem>
                            <SelectItem value="userType">Tipo de Usuário</SelectItem>
                            <SelectItem value="intent">Intenção Detectada</SelectItem>
                          </SelectContent>
                        </Select>
                        
                        <Select defaultValue="contains">
                          <SelectTrigger className="w-40">
                            <SelectValue placeholder="Operador" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="equals">Igual a</SelectItem>
                            <SelectItem value="contains">Contém</SelectItem>
                            <SelectItem value="startsWith">Começa com</SelectItem>
                            <SelectItem value="endsWith">Termina com</SelectItem>
                          </SelectContent>
                        </Select>
                        
                        <Input placeholder="Valor" className="flex-1" />
                        
                        <Button variant="ghost" size="sm" className="px-2">
                          ×
                        </Button>
                      </div>
                    </div>
                  </div>
                </Card>
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="contextPriority">Prioridade</Label>
                <Select defaultValue="medium">
                  <SelectTrigger id="contextPriority">
                    <SelectValue placeholder="Selecione a prioridade" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="high">Alta (Sobrescreve outros contextos)</SelectItem>
                    <SelectItem value="medium">Média</SelectItem>
                    <SelectItem value="low">Baixa</SelectItem>
                  </SelectContent>
                </Select>
                <p className="text-xs text-muted-foreground">
                  Quando múltiplos contextos são aplicáveis, o de maior prioridade será usado.
                </p>
              </div>
              
              <div className="space-y-2">
                <Label>Fontes de Conhecimento a Priorizar</Label>
                <div className="border rounded-md p-4 space-y-2">
                  <div className="flex items-center space-x-2">
                    <Checkbox id="knowledgeSource1" />
                    <Label htmlFor="knowledgeSource1">Manual do Produto X</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Checkbox id="knowledgeSource2" />
                    <Label htmlFor="knowledgeSource2">FAQ do Site Institucional</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Checkbox id="knowledgeSource3" />
                    <Label htmlFor="knowledgeSource3">Blog da Empresa</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Checkbox id="knowledgeSource4" />
                    <Label htmlFor="knowledgeSource4">Perguntas Frequentes - Clientes</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Checkbox id="knowledgeSource5" />
                    <Label htmlFor="knowledgeSource5">Documentação Técnica API</Label>
                  </div>
                </div>
              </div>
              
              <div className="space-y-2">
                <Label>Personalidade e Tom para este Contexto</Label>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <Label htmlFor="persona" className="text-sm">Persona</Label>
                    <Select defaultValue="specialist">
                      <SelectTrigger id="persona">
                        <SelectValue placeholder="Selecione a persona" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="specialist">Especialista Técnico</SelectItem>
                        <SelectItem value="salesperson">Consultor de Vendas</SelectItem>
                        <SelectItem value="supportagent">Agente de Suporte</SelectItem>
                        <SelectItem value="teacher">Professor/Educador</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div>
                    <Label htmlFor="tone" className="text-sm">Tom de Comunicação</Label>
                    <Select defaultValue="professional">
                      <SelectTrigger id="tone">
                        <SelectValue placeholder="Selecione o tom" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="professional">Profissional</SelectItem>
                        <SelectItem value="casual">Casual</SelectItem>
                        <SelectItem value="friendly">Amigável</SelectItem>
                        <SelectItem value="formal">Formal</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="escalationRules">Regras de Escalonamento</Label>
                <Textarea 
                  id="escalationRules" 
                  placeholder="Defina quando a IA deve escalonar para um atendente humano..."
                />
              </div>
              
              <div className="flex justify-end gap-2">
                <Button variant="outline">Cancelar</Button>
                <Button>
                  <Save className="mr-2 h-4 w-4" /> Salvar Contexto
                </Button>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
        
        <TabsContent value="rules" className="space-y-4 pt-4">
          <Card>
            <CardHeader>
              <CardTitle>Regras Gerais de Comportamento</CardTitle>
              <CardDescription>
                Defina como a IA deve se comportar independentemente do contexto
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="generalInstructions">Instruções Gerais</Label>
                <Textarea 
                  id="generalInstructions"
                  className="min-h-[150px]"
                  defaultValue="A IA Prof. Ana deve sempre: 
1. Ser respeitosa e educada em todas as interações
2. Evitar fornecer informações sobre concorrentes
3. Nunca compartilhar preços exatos (direcionar para um consultor)
4. Evitar discussões políticas ou religiosas
5. Não fazer promessas que não pode cumprir"
                />
              </div>
              
              <div className="space-y-2">
                <Label>Tópicos Proibidos</Label>
                <div className="border rounded-md p-4 space-y-2">
                  <div className="flex items-center space-x-2">
                    <Checkbox id="topic1" defaultChecked />
                    <Label htmlFor="topic1">Informações sobre concorrentes</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Checkbox id="topic2" defaultChecked />
                    <Label htmlFor="topic2">Discussões políticas</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Checkbox id="topic3" defaultChecked />
                    <Label htmlFor="topic3">Assistência jurídica</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Checkbox id="topic4" defaultChecked />
                    <Label htmlFor="topic4">Informações pessoais de colaboradores</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Checkbox id="topic5" />
                    <Label htmlFor="topic5">Descontos e condições especiais</Label>
                  </div>
                </div>
              </div>
              
              <div className="flex justify-end">
                <Button>
                  <Save className="mr-2 h-4 w-4" /> Salvar Regras Gerais
                </Button>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
        
        <TabsContent value="fallbacks" className="space-y-4 pt-4">
          <Card>
            <CardHeader>
              <CardTitle>Respostas de Fallback</CardTitle>
              <CardDescription>
                Configure as respostas padrão para situações específicas
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="unknownAnswer">Quando Não Sabe a Resposta</Label>
                <Textarea 
                  id="unknownAnswer"
                  className="min-h-[80px]"
                  defaultValue="Desculpe, não tenho informações suficientes para responder a essa pergunta. Posso transferir você para um dos nossos atendentes humanos que poderá ajudar melhor. Ou, se preferir, posso buscar informações sobre outro assunto."
                />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="offTopicResponse">Quando o Tópico é Proibido</Label>
                <Textarea 
                  id="offTopicResponse"
                  className="min-h-[80px]"
                  defaultValue="Agradeço sua pergunta, mas esse é um tópico que não estou autorizado a discutir. Posso ajudar com informações sobre nossos produtos e serviços ou outras dúvidas relacionadas à nossa empresa."
                />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="confusedResponse">Quando Não Entende a Pergunta</Label>
                <Textarea 
                  id="confusedResponse"
                  className="min-h-[80px]"
                  defaultValue="Não tenho certeza se entendi corretamente sua pergunta. Poderia reformular ou fornecer mais detalhes para que eu possa ajudar melhor?"
                />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="escalationResponse">Ao Escalonar para Humano</Label>
                <Textarea 
                  id="escalationResponse"
                  className="min-h-[80px]"
                  defaultValue="Vou transferir você para um de nossos atendentes humanos que poderá ajudar com essa questão específica. Por favor, aguarde um momento enquanto faço a transferência."
                />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="greetingResponse">Saudação Inicial</Label>
                <Textarea 
                  id="greetingResponse"
                  className="min-h-[80px]"
                  defaultValue="Olá! Sou a Prof. Ana, assistente virtual da [Nome da Empresa]. Como posso ajudar você hoje?"
                />
              </div>
              
              <div className="flex justify-end">
                <Button>
                  <Save className="mr-2 h-4 w-4" /> Salvar Respostas de Fallback
                </Button>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );
};